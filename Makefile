# ------------------------------------------------
# Build settings
# ------------------------------------------------
CC        := gcc
CFLAGS    := -Wall -Wextra -g -Iinclude

# ------------------------------------------------
# Directories
# ------------------------------------------------
SRC_DIR   := src
OBJ_DIR   := build
INC_DIR   := include

# ------------------------------------------------
# Sources and objects
# ------------------------------------------------
SRCS      := $(wildcard $(SRC_DIR)/*.c)
OBJS      := $(patsubst $(SRC_DIR)/%.c,$(OBJ_DIR)/%.o,$(SRCS))

# ------------------------------------------------
# Target executable
# ------------------------------------------------
TARGET    := tossh

# ------------------------------------------------
# Default target
# ------------------------------------------------
.PHONY: all
all: $(TARGET)

# ------------------------------------------------
# Link step
# ------------------------------------------------
$(TARGET): $(OBJS)
	$(CC) $(CFLAGS) -o $@ $^

# ------------------------------------------------
# Compile step
# ------------------------------------------------
# (order-only prerequisite でディレクトリ生成)
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.c | $(OBJ_DIR)
	$(CC) $(CFLAGS) -c $< -o $@

# build ディレクトリがなければ作成
$(OBJ_DIR):
	mkdir -p $(OBJ_DIR)

# ------------------------------------------------
# Clean up
# ------------------------------------------------
.PHONY: clean
clean:
	rm -rf $(OBJ_DIR) $(TARGET)
